
## extract_group_ids
isMemberOf属性からグループIDを取り出す

#### シグネチャ
```python[permission.py]
def extract_group_ids(is_member_of: str) -> list[str]:
```

#### 引数
| 名前         | 型  | 説明           |
| ------------ | --- | -------------- |
| is_member_of | str | isMemberOf属性 |

#### 戻り値
| 型        | 説明                   |
| --------- | ---------------------- |
| list[str] | 所属グループのIDリスト |

#### 処理内容
1. is_member_ofを「/gr/...;」または「/gr/.../」の中身を取り出す
2. グループidのリストに変換し返却する

## is_sysadmin
ログインユーザーがシステム管理者であるかを判定する

#### シグネチャ
```python[permission.py]
def is_systemadmin(is_member_of: str) -> bool:
```

#### 引数
| 名前         | 型  | 説明                             |
| ------------ | --- | -------------------------------- |
| is_member_of | str | ログインユーザーのisMemberOf属性 |

#### 戻り値
| 型   | 説明                                     |
| ---- | ---------------------------------------- |
| bool | ログインユーザーがシステム管理者かどうか |

#### 処理内容
1. `services.permission::extract_group_ids()`でグループIDを取得
2. group_idsに`config.GROUPS.id_patterns.system_admin`が含まれていればtrueを返却
3. 含まれていなければfalseを返却

## is_manageable_group_id
編集/削除対象のグループIDがログインユーザーの管理可能範囲に含まれているかを判定する

#### シグネチャ
```python[permission.py]
def is_manageable_group_id(group_id: str) -> bool:
```

#### 引数
| 名前     | 型  | 説明                      |
| -------- | --- | ------------------------- |
| group_id | str | 編集/削除対象のグループID |

#### 戻り値
| 型   | 説明             |
| ---- | ---------------- |
| bool | 管理可能かどうか |

#### 処理内容
1. `current_user.is_sysadmin`がTrueならTrueを返却
2. services.utils.affiliations::detect_affiliations()を用いてgroup_idをもとにAffiliationを取得
3. ロール用グループならばFalseを返却
4. ロール用グループでなければrepository_idを取得
5. current_user.isMemberOfを引数に[`extract_group_ids`](#extract_group_ids)でグループIDのリストにする
6. jc_{repository_id}_roles_repoadmが含まれているかどうかを返却

## get_user_roles

#### シグネチャ
```python[permission.py]
def get_user_roles(group_ids: list[str]) -> set[str]:
```

#### 引数
| 名前      | 型        | 説明                             |
| --------- | --------- | -------------------------------- |
| group_ids | list[str] | ログインユーザーのグループリスト |

#### 戻り値
| 型       | 説明                 |
| -------- | -------------------- |
| set[str] | ユーザーの持つロール |

#### 処理内容
1. is_member_ofを引数に[`extract_group_ids`](#extract_group_ids)でグループIDのリストを取得
2. `services.utils.affiliations:detect_affiliations`を用いて分類する
3. Affiliations.rolesの各要素のrolesをset[str]にまとめuser_roleとする
4. user_roleを返却する
