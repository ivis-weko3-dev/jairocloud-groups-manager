---
title: services.repositories
description: 当システムのリポジトリ管理に関するビジネスロジックを提供する。
---

## get_repository_member
- リポジトリに属するgroupとユーザーのidを取得する

#### 引数
| 変数名        | 型  | 説明                     |
| ------------- | --- | ------------------------ |
| repository_id | str | 選択されたリポジトリのID |

#### 戻り値
| 型         | 説明                        |
| ---------- | --------------------------- |
| list\[str] | リポジトリに属するgroupのid |
| list\[str] | リポジトリに属するuserのid  |

#### エラー
| 型                                                                            | 説明                                                                        |
| ----------------------------------------------------------------------------- | --------------------------------------------------------------------------- |
| [OAuthTokenError](../02.foundation/07.exc.md#oauthtokenerror)                 | アクセストークンが無効または期限切れまたはDBに存在しない場合                |
| [CredentialsError](../02.foundation/07.exc.md#credentialserror)               | クライアントシークレットがDBに存在しない場合                                |
| [ResourceInvalid](../02.foundation/07.exc.md#resourceinvalid)                 | ｍAP Core APIのレスポンスが[MapError](../03.entities/04.map_error.md)の場合 |
| [UnexpectedResponseError](../02.foundation/07.exc.md#unexpectedresponseerror) | ｍAP Core APIのサーバーエラー等の予期せぬエラーが発生した場合               |

#### 処理内容
1. [`token.get_oauth_token`](../05.services/01.token.md#get_oauth_token)でアクセストークンを取得する。
2. [`token.get_client_secret`](../05.services/01.token.md#get_client_secret)でクライアントシークレットを取得する。
3. 認証情報取得時に[`OAuthTokenError`](../02.foundation/07.exc.md#oauthtokenerror),[`CredentialsError`](../02.foundation/07.exc.md#credentialserror)が発生した場合はそのまま送出する。
4. client.groups::search()でrepository_idに紐づくグループのリストを取得する
5. レスポンスが[MapError](../03.entities/04.map_error.md)の場合[ResourceInvalid](../02.foundation/07.exc.md#resourceinvalid)を送出する。
6. ｍAP Core APIのサーバーエラー等が発生した場合[`UnexpectedResponseError`](../02.foundation/07.exc.md#unexpectedresponseerror)を送出する。
7. グループIDのリストとmembersからMemberUserのIDのリストを作成する
8. RepositoryMemberオブジェクトを作成
9. RepositoryMemberを返却する

## get_filter_options
リポジトリ一覧のフィルター選択肢を取得する

#### シグネチャ
```python[repositories.py]
def get_filter_options() -> RepositoryFilterOption:
```

#### 引数
| 名前         | 型  | 説明           |
| ------------ | --- | -------------- |
| is_member_of | str | isMemberOf属性 |

#### 戻り値

| 型                     | 説明                             |
| ---------------------- | -------------------------------- |
| RepositoryFilterOption | リポジトリのフィルターオプション |

#### 処理方法
1. is_member_ofを引数に[`get_user_roles`](../05.services/08.permission.md#get_user_roles)で管理対象のリポジトリIDを取得
2. services.groups:searchでリポジトリIDを含むグループを検索しIDとmembersのうちtype="User"のIDをリスト化
2. RepositoryFilterOptionを作成し返却する
