---
title: api.helper
description: コントローラー層で使用するデコレータを定義する
---

## roles_required
ユーザーが権限を持っているか検証するデコレータ

#### シグネチャ
```python[helper.py]
def roles_required(*roles: str) -> Callable[[Callable[P, R]], Callable[P, R]]:
```

#### 引数
| 名前   | 型  | 説明                                 |
| ------ | --- | ------------------------------------ |
| *roles | str | アクセスを許可するロール(可変長引数) |

#### 戻り値
| 型           | 説明                               |
| ------------ | ---------------------------------- |
| Literal[403] | ユーザーに要求された権限がない場合 |

#### 処理内容
1. current_user.is_member_ofを引数に[`services.permission:extract_group_ids`](../05.services/08.permission.md#extract_group_ids)でグループリストを取得
2. グループリストを引数に[`services.permission:get_user_roles`](../05.services/08.permission.md#get_user_roles)でuser_roleを取得
3. 含まれていなければ403を返す

## update_login_session_ttl
ログインセッションのTTLを更新する

#### シグネチャ
```
@app.before_request
def update_login_session_ttl():
```

#### 処理内容
1. session.get(_id)でsession_idを取得
2. expire(\<prefix>\_login_<self.session_id>,REDIS_TTL)でTTLを更新
